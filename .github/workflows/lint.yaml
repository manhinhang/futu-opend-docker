name: Lint

on: # yamllint disable-line rule:truthy
    push: null
    pull_request: null

permissions:
  contents: write
  pull-requests: write

jobs:
    lint:
        name: Lint
        runs-on: ubuntu-latest
        permissions:
            contents: write
            pull-requests: write
            # To report GitHub Actions status checks
            statuses: write

        steps:
        - name: Checkout code
          uses: actions/checkout@v4
          with:
            # super-linter needs the full git history to get the
            # list of files that changed across commits
            fetch-depth: 0

        - name: Super-linter
          uses: super-linter/super-linter@v7.4.0 # x-release-please-version
          continue-on-error: true
          env:
            # To report GitHub Actions status checks
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            # Enable auto-fix
            AUTO_FIX: true
            # Linter rules path (optional)
            LINTER_RULES_PATH: .github/linters

        - name: Check for changes
          id: check_changes
          run: |
            if [[ -n "$(git status --porcelain)" ]]; then
              echo "has_changes=true" >> $GITHUB_OUTPUT
            else
              echo "has_changes=false" >> $GITHUB_OUTPUT
            fi
          
        - name: Create Pull Request
          if: steps.check_changes.outputs.has_changes == 'true'
          env:
            GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          run: |
            git config --global user.name "github-actions[bot]"
            git config --global user.email "github-actions[bot]@users.noreply.github.com"
            git add .
            git commit -m "chore: auto-fix linting issues"
            git push origin HEAD:auto-fix/linting-$(date +%s)
            
            gh pr create \
              --title "chore: auto-fix linting issues" \
              --body "This PR contains automatic fixes for linting issues found by super-linter.
            
            ## Changes made:
            - Auto-fixed formatting issues
            - Resolved linting violations
            - Improved code quality
            
            This PR was automatically generated by the linting workflow." \
              --base ${{ github.head_ref }} \
              --head auto-fix/linting-$(date +%s)
